<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 협업 리더 역량 진단 설문 (로컬 저장용)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind JIT 활성화 및 설정
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {}
            },
            plugins: [],
        }
    </script>
    <style>
        /* Noto Sans KR 폰트 설정 (한글 우선 적용) */
        :root {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        /* 기본 글자 크기, 줄 간격 조정으로 가독성 향상 */
        body {
            font-size: 16px;
            line-height: 1.6;
            color: #333; /* Darker default text for better contrast */
        }

        /* --- 커스텀 라디오 버튼 스타일 --- */
        
        .rating-input {
            display: none; 
        }
        
        .rating-label {
            /* flex-grow: 1 대신 min-width를 사용하여 모바일에서 겹침 방지 및 줄바꿈 유도 */
            min-width: calc(20% - 0.5rem); 
            flex-basis: auto; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: space-between; 
            cursor: pointer; 
            padding: 0.75rem 0.25rem; 
            min-height: 90px; 
            border-radius: 0.75rem; 
            transition: all 0.2s ease-in-out; 
            text-align: center;
            margin: 0.25rem; 
            
            /* 배경색, 테두리, 그림자 완전히 제거 */
            border: none;
            background-color: transparent;
            box-shadow: none;
        }

        /* 모바일 환경에서 버튼 너비 조정 */
        @media (max-width: 640px) { /* sm breakpoint */
            .rating-label {
                min-width: calc(50% - 0.5rem); 
                min-height: 80px; 
            }
            /* 점수별 설명 텍스트 크기 모바일 최적화 */
            .rating-score-text {
                font-size: 0.8rem; 
            }
        }
        @media (max-width: 480px) { /* 더 작은 모바일 화면 */
            .rating-label {
                min-width: calc(100% - 0.5rem); 
                min-height: 70px;
            }
            .rating-score-text {
                font-size: 0.9rem;
            }
        }


        /* 호버 시 시각적 피드백 제거 (텍스트만 살짝 밝게) */
        .rating-label:hover {
            background-color: transparent; 
            transform: none; 
        }
        .rating-label:hover .rating-score-text {
            color: #64748b; /* slate-500: 호버 시 텍스트 색상만 살짝 변경 */
        }


        /* 작은 동그라미 (체크 마크)의 기본 스타일 */
        .rating-circle {
            width: 1.25rem; 
            height: 1.25rem; 
            border-radius: 9999px; 
            border-width: 2px; 
            border-color: #94a3b8; /* slate-400 */
            background-color: #ffffff; 
            display: block; 
            margin-bottom: 0.5rem; 
            transition: all 0.15s ease-in-out;
        }

        /* 점수 텍스트 (보기 설명)의 기본 스타일 */
        .rating-score-text {
            font-size: 0.875rem; 
            font-weight: 500; 
            color: #4b5563; /* text-gray-700 */
            line-height: 1.3; 
            transition: all 0.15s ease-in-out;
        }
        
        .rating-score-number {
             font-weight: 700; 
             margin-right: 0.15rem;
             color: #4f46e5; /* indigo-600 */
        }

        /* --- Input이 선택되었을 때의 스타일 (핵심 기능) --- */
        
        /* 선택 시 라벨 배경 강조 및 테두리 색상 변경 제거 */
        .rating-input:checked + .rating-label {
            background-color: transparent; 
            transform: none; 
            box-shadow: none;
        }

        /* 작은 동그라미 칸에 색 채우기 */
        .rating-input:checked + .rating-label .rating-circle {
            background-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5; /* indigo-600 */
            transform: scale(1.1); 
        }

        /* 선택된 보기 텍스트를 굵게 변경 및 색상 강조 */
        .rating-input:checked + .rating-label .rating-score-text {
            font-weight: 700; 
            color: #3730a3; /* indigo-900 */
        }
        .rating-input:checked + .rating-label .rating-score-number {
            color: #3730a3; /* indigo-900 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">
    <div id="app" class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-6 sm:p-10">
        
        <header class="text-center mb-10 border-b pb-6 border-gray-200">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-slate-800 mb-2 leading-tight">
                AI 협업 워크플로우 리더 역량 진단
            </h1>
            <p class="text-gray-600 text-lg sm:text-xl">
                교육 시작 전, 리더님의 현재 AI 협업 준비 수준을 자가 진단해 보세요.
            </p>
        </header>

        <form id="assessmentForm">
            <div id="questionsContainer" class="space-y-8"></div>

            <div class="mt-12">
                <!-- API 호출 상태 표시기 제거 (로컬 저장 버전) -->

                <button type="submit" id="submitButton"
                    class="w-full bg-slate-700 hover:bg-slate-800 text-white font-bold py-3 sm:py-4 px-4 rounded-lg transition duration-300 shadow-lg hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-slate-500 focus:ring-opacity-50 text-lg">
                    진단 결과 확인하기
                </button>
            </div>
        </form>

        <div id="resultsContainer" class="hidden mt-16 pt-8 border-t-4 border-slate-300">
            <h2 class="text-3xl sm:text-4xl font-bold text-slate-700 mb-8 text-center">종합 진단 결과</h2>
            
            <div id="scoreSummary" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                </div>

            <div id="feedbackDetails" class="space-y-8 mt-10">
                </div>

            <div class="mt-12 text-center space-x-2 sm:space-x-4">
                 <button id="goBackButton"
                    class="bg-slate-700 hover:bg-slate-800 text-white font-bold py-3 px-4 sm:px-6 rounded-lg transition duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-opacity-50 text-base sm:text-lg">
                    응답 확인 및 수정하기
                </button>
                 <button id="restartButton"
                    class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 sm:px-6 rounded-lg transition duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 text-base sm:text-lg">
                    설문 다시 시작하기
                </button>
            </div>
            
            <div class="mt-8 text-center text-gray-600 border-t pt-4">
                <p class="font-medium text-sm sm:text-base">이 결과는 리더님의 교육 집중 영역을 안내하며, 절대적인 평가 기준이 아님을 알려드립니다.</p>
            </div>
        </div>
    </div>

    <script>
        // 설문 문항 데이터 정의
        const surveyData = [
            {
                id: 'I',
                title: 'I. 리더 개인의 AI 이해도 및 활용 수준 (개인 역량 진단)',
                questions: [
                    "우리 팀/부서의 미래 성장을 위해 AI 기술의 활용이 필수적이라고 생각한다.",
                    "생성형 AI (예: ChatGPT)의 기본적인 작동 방식과 주요 장단점에 대해 어느 정도 알고 있다.",
                    "업무와 무관하게 개인적인 호기심으로 AI 도구 (예: 글쓰기, 이미지 생성 등)를 시도해 본 경험이 많다.",
                    "우리 팀 업무에 어떤 AI 도구를 어떻게 적용해 볼 수 있을지 구체적으로 고민하고 있다.",
                    "AI 기술의 발전에 맞춰 새로운 활용법을 학습하고 습득하려는 의지가 높다.",
                    "AI 기술 및 트렌드 변화에 대한 정보를 정기적으로 찾아보며 흐름을 놓치지 않으려 노력한다.",
                    "AI를 새로운 기술이나 도구라기보다 친숙한 협업 파트너로 받아들이는 데 어려움이 없다."
                ]
            },
            {
                id: 'II',
                title: 'II. 팀/부서 업무 본질 및 프로세스 인식 (팀 역량 진단)',
                questions: [
                    "우리 팀의 핵심 업무가 조직에 제공하는 궁극적인 가치가 무엇인지 명확히 이해하고 있다.",
                    "팀의 핵심 업무 프로세스를 시작부터 끝까지 주요 단계별로 머릿속에 명확히 그릴 수 있다.",
                    "팀의 업무 흐름을 '로직 트리'나 '플로우 차트'와 같은 분석 기법을 활용하여 체계적으로 분석해 본 경험이 충분하다.",
                    "현재 팀 프로세스의 각 단계에서 AI 협업이 가능한 구체적인 포인트를 상상해 본 적이 있다.",
                    "팀원들의 비공식 AI 도구 사용 (Shadow AI) 상황을 인지하고, 정보 보안 관점에서 가이드라인을 모색 중이다.",
                    "팀 업무에 활용되는 데이터가 AI 도구가 활용하기 좋은 형태로 정제되고 구조화되어 있다고 생각한다.",
                    "팀원들이 업무 중 AI 활용에 대해 자유롭게 공유하고 피드백을 주고받는 분위기를 장려하고 있다."
                ]
            },
            {
                id: 'III',
                title: 'III. AI 시대 리더의 역할 재정의 및 전략 (리더십 방향성 진단)',
                questions: [
                    "AI 도입이 단순한 효율 향상을 넘어, 우리 팀의 업무 방식 자체를 근본적으로 바꿀 수 있다고 믿는다.",
                    "AI가 팀원들의 업무 역할과 책임을 변화시키고 새로운 가치 창출 기회를 만들 것이라고 예상한다.",
                    "우리 팀이 AI를 활용하여 가장 먼저 변화시키고 싶은 업무 영역에 대한 우선순위는 가지고 있다.",
                    "AI 시대에 팀원들에게 필요한 새로운 협업 방식이나 역량 (예: 프롬프트 활용)에 대해 고민하고 있다.",
                    "팀원들이 AI 활용을 실패하더라도 시도와 실험을 장려하는 심리적 안전지대를 제공할 의지가 있다.",
                    "AI 활용 증가로 인해 발생하는 업무 결과물에 대한 평가 기준 변화에 대해 유연하게 대처할 준비가 되어 있다."
                ]
            }
        ];

        // 점수대별 진단 해설 데이터
        const feedbackData = {
            'I': {
                high: { title: '✨ AI 선도 학습자', message: '✅ <b>현재 상태:</b> AI에 대한 관심과 학습 동기가 매우 높고, 개인적인 활용 경험도 풍부합니다. 기술 변화에 대한 심리적 장벽이 낮아 새로운 도전을 즐길 준비가 되어 있습니다. \n\n🚀 <b>성장 방향:</b> 리더님의 높은 기술 이해도를 <b>팀 단위의 워크플로우 분석</b>과 <b>전략적 역할 재정의</b>로 확장하는 데 집중하십시오. 교육 과정에서 <b>실행 전략 수립</b>에 깊이를 더해 팀을 선도할 수 있습니다.' },
                mid: { title: '💡 AI 관심 확보 단계', message: '✅ <b>현재 상태:</b> AI의 필요성은 인식하지만, 개인적인 사용 경험이나 정보를 적극적으로 찾는 노력은 보통 수준입니다. AI를 도입해야 한다는 당위성은 있지만, 첫걸음이 망설여지는 단계입니다. \n\n💪 <b>성장 방향:</b> AI를 \'알아야 하는 것\'에서 \'써야 하는 도구\'로 전환하는 것이 중요합니다. 교육 초반에 제시될 리더급 AI 활용 사례를 통해 동기 부여를 얻고 <b>적극적으로 실습</b>하여 기술 장벽을 극복하는 기회로 삼으십시오.' },
                low: { title: '🌱 AI 경험 초기 단계', message: '✅ <b>현재 상태:</b> AI 기술에 대한 막연한 거리감이 있거나, 개인적 활용 및 학습 시도가 부족한 상태입니다. AI를 어떻게 시작해야 할지, 리더로서 무엇부터 배워야 할지 고민이 많은 단계입니다. \n\n🎯 <b>성장 방향:</b> AI를 경쟁자가 아닌 <b>협업 파트너</b>로 받아들이는 <b>인식 전환</b>이 가장 시급합니다. 교육의 <b>1단계(AI를 알아야 하는 이유)</b>에 집중하여, 리더로서 AI 활용의 <b>당위성과 안전한 사용법</b>을 먼저 습득하고 학습의 기초를 다지도록 독려합니다.' }
            },
            'II': {
                high: { title: '🗺️ 프로세스 통찰 리더', message: '✅ <b>현재 상태:</b> 팀의 핵심 업무 가치와 AS-IS 프로세스에 대한 명확한 통찰력을 가지고 있습니다. Shadow AI와 데이터 환경에 대한 인식도 높아 AI 도입 기반이 탄탄합니다. \n\n🚀 <b>성장 방향:</b> 이미 분석 기반이 탄탄하므로, 교육의 <b>2단계(워크플로우 분석)</b>를 통해 <b>단계별 AI 협업 기회</b>를 바로 구체화하고 <b>가장 큰 혁신 효과</b>를 낼 수 있는 포인트를 발굴하는 데 집중하십시오. 발견된 기회를 빠르게 실행하는 데 집중해 주세요.' },
                mid: { title: '📝 프로세스 진단 강화 필요', message: '✅ <b>현재 상태:</b> 업무는 이해하지만, 프로세스 진단(로직 트리 등) 경험이 부족하고, AI 도입을 위한 데이터 및 보안 환경에 대한 고민이 진행 중인 단계입니다. \n\n💪 <b>성장 방향:</b> 교육의 <b>2단계(워크플로우 분석)</b>에서 제시하는 <b>체계적인 로직 트리 분석 방법론</b>을 습득하여, 머릿속의 프로세스를 <b>객관화</b>하고 <b>AI 협업 기회를 정량적으로 탐색</b>하는 역량을 강화하는 데 집중하십시오.' },
                low: { title: '🧭 업무 본질 인식 재정립', message: '✅ <b>현재 상태:</b> 팀 업무의 핵심 가치 정의가 모호하고, 현재 워크플로우를 체계적으로 진단해 본 경험이 부족한 상태입니다. AI 도입 이전에 팀의 근본적인 문제점을 파악하는 것이 필요합니다. \n\n🎯 <b>성장 방향:</b> 교육의 <b>2단계</b>에 <b>가장 적극적으로 참여</b>하여 <b>AS-IS 프로세스를 재정의</b>하고, <b>팀이 창출하는 궁극적인 가치</b>를 명확히 하는 방법을 배우는 데 집중해야 합니다. 혁신의 첫 단추를 끼우는 과정에 몰입해 주세요.' }
            },
            'III': {
                high: { title: '👑 미래 변화 주도 리더', message: '✅ <b>현재 상태:</b> AI가 가져올 변화의 파급력을 믿고 있으며, 팀원의 육성, 실험적 문화 지원, 평가 기준 변화에 대한 인식과 의지가 확고합니다. 변화를 이끌 준비가 되어 있습니다. \n\n🚀 <b>성장 방향:</b> 교육의 <b>3, 4단계(재설계 및 역할 재정의)</b>를 통해 리더님의 강력한 의지를 <b>실질적인 변화 관리 전략</b>과 <b>AI 시대에 맞는 팀 운영 모델</b>로 최적화하십시오. <b>롤 모델</b>으로서의 역할을 완성하는 데 집중해 주세요.' },
                mid: { title: '🤝 역할 변화 고민 단계', message: '✅ <b>현재 상태:</b> AI의 영향력은 인지하지만, 팀원들의 새로운 역량 육성, 평가 기준 변화, 실험 문화 조성에 대한 <b>구체적인 지원 방안</b>에 대한 고민은 진행 중인 단계입니다. \n\n💪 <b>성장 방향:</b> AI 시대 리더의 역할은 \'촉진자/지원자\'입니다. 교육의 <b>4단계(리더의 역할 재정의)</b>를 통해 <b>팀원들의 자발적 AI 활용</b>을 이끌어낼 수 있는 <b>실질적인 지원 전략</b>과 <b>유연한 평가 기준</b> 설정 방안을 모색하는 데 집중하십시오.' },
                low: { title: '🔄 리더십 관점 전환 필수', message: '✅ <b>현재 상태:</b> AI가 업무 프로세스 자체를 바꾼다는 믿음이 약하며, 변화 관리 및 팀 지원에 대한 의지가 낮은 상태입니다. 새로운 기술에 대한 리더십 관점 전환이 필요합니다. \n\n🎯 <b>성장 방향:</b> AI는 단순히 \'업무 개선\'을 넘어 \'업무 재설계\'를 요구합니다. 교육의 <b>3단계(재설계)</b>와 <b>4단계(역할 재정의)</b>에서 제시하는 <b>AI 시대의 새로운 리더십 관점</b>을 반드시 내재화하고, 변화를 주도하는 첫 걸음을 내딛는 데 집중해 주세요.' }
            }
        };

        // DOM 요소 정의
        const questionsContainer = document.getElementById('questionsContainer');
        const assessmentForm = document.getElementById('assessmentForm');
        const resultsContainer = document.getElementById('resultsContainer');
        const scoreSummary = document.getElementById('scoreSummary');
        const feedbackDetails = document.getElementById('feedbackDetails');
        const restartButton = document.getElementById('restartButton');
        const goBackButton = document.getElementById('goBackButton'); 
        
        let currentResults = null;
        let userResponses = []; // 응답 내용을 저장할 배열

        // -------------------------------------------------------------------------
        // CSV 파일 다운로드 기능 (로컬 저장)
        // -------------------------------------------------------------------------

        // 배열 데이터를 CSV 형식 문자열로 변환 (UTF-8 BOM 포함)
        function convertToCSV(data) {
            const BOM = "\uFEFF"; // 엑셀에서 한글 깨짐 방지용 BOM
            const headers = ["문항 번호", "진단 영역", "문항 내용", "응답 점수"];
            const headerRow = headers.join(',') + '\n';
            
            const rows = data.map(row => {
                // 문항 내용에 쉼표나 따옴표가 있을 경우를 대비해 큰따옴표로 묶음
                const content = `"${row.content.replace(/"/g, '""')}"`;
                return [row.index, row.area, content, row.score].join(',');
            }).join('\n');
            
            return BOM + headerRow + rows;
        }

        // CSV 파일 다운로드 실행
        function exportResponsesToCSV() {
            if (userResponses.length === 0) {
                console.error("저장할 응답 내용이 없습니다.");
                return;
            }

            const csvContent = convertToCSV(userResponses);
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            
            // 파일명 생성: 'AI역량진단_YYYYMMDD_HHMM.csv'
            const now = new Date();
            const timestamp = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
            const filename = `AI역량진단_${timestamp}.csv`;

            // 다운로드 링크 생성 및 클릭
            const link = document.createElement('a');
            if (link.download !== undefined) { // 최신 브라우저 지원 확인
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                console.error("이 브라우저에서는 파일 다운로드를 지원하지 않습니다.");
            }
        }
        // -------------------------------------------------------------------------

        // 레벨 문자열을 반환하는 헬퍼 함수
        function getLevelInfo(average) {
            if (average >= 4.0) {
                return { level: 3, name: "Level 3 (변화 주도)" };
            } else if (average >= 3.0) {
                return { level: 2, name: "Level 2 (활용 확장)" };
            } else {
                return { level: 1, name: "Level 1 (기반 정립)" };
            }
        }


        // 1. 설문 문항 동적 생성 함수
        function renderQuestions() {
            let qCounter = 1;
            questionsContainer.innerHTML = ''; // 컨테이너 초기화

            const scoreLabels = [
                "전혀 그렇지 않다",
                "그렇지 않다",
                "보통이다",
                "약간 그렇다",
                "매우 그렇다"
            ];

            surveyData.forEach(area => {
                // 영역 제목
                const areaTitleDiv = document.createElement('div');
                areaTitleDiv.className = 'pb-2 mb-4'; 
                areaTitleDiv.innerHTML = `<h2 class="text-xl sm:text-2xl font-semibold text-slate-700">${area.title}</h2>`; // 타이틀 색상 변경
                questionsContainer.appendChild(areaTitleDiv);

                // 영역별 테두리 그룹 컨테이너
                const areaContentDiv = document.createElement('div');
                areaContentDiv.className = 'border border-gray-300 rounded-xl p-4 sm:p-6 mb-6'; 
                questionsContainer.appendChild(areaContentDiv);


                area.questions.forEach((qText, index) => {
                    const qIndex = qCounter++;
                    const questionDiv = document.createElement('div');
                    
                    // 문항 간 얇은 회색 실선 구분 (두 번째 문항부터 상단 테두리 추가)
                    const separatorClass = index > 0 ? 'pt-4 border-t border-gray-200 mt-4' : '';
                    
                    questionDiv.className = `pb-4 ${separatorClass}`; // 개별 문항 스타일: 패딩 및 구분선

                    // 질문 텍스트
                    questionDiv.innerHTML = `
                        <p class="text-base sm:text-lg font-medium text-gray-800 mb-4 leading-relaxed">
                            <span class="text-slate-700 font-bold mr-2">${qIndex}.</span> ${qText}
                        </p>
                        
                        <div class="flex flex-wrap justify-center sm:justify-between -m-1"> ${[1, 2, 3, 4, 5].map(score => `
                                <input type="radio" id="q${qIndex}-${score}" name="q${qIndex}" value="${score}"
                                    class="rating-input" data-area="${area.id}" data-q-content="${qText}">
                                <label for="q${qIndex}-${score}" class="rating-label">
                                    <span class="rating-circle"></span>
                                    <span class="rating-score-text">
                                        <span class="rating-score-number">${score}.</span>
                                        ${scoreLabels[score - 1]}
                                    </span>
                                </label>
                            `).join('')}
                        </div>
                    `;
                    areaContentDiv.appendChild(questionDiv);
                });
            });
        }

        // 2. 점수 계산 및 진단 로직 함수
        function calculateAndDisplayResults(event) {
            event.preventDefault(); // 폼 제출 기본 동작 방지

            const form = event.target;
            let allAnswered = true;
            let scores = { I: [], II: [], III: [] };
            userResponses = []; // 응답 저장 배열 초기화

            // 모든 라디오 버튼 응답 수집
            for (let i = 1; i <= 20; i++) {
                const qName = `q${i}`;
                const checkedInput = form.querySelector(`input[name="${qName}"]:checked`);
                
                if (!checkedInput) {
                    allAnswered = false;
                    // 미응답 문항을 찾았을 때 해당 문항으로 스크롤 이동 (UX 개선)
                    const questionElement = document.querySelector(`input[name="${qName}"]`).closest('div[class*="pt-4"]'); // 질문 div 탐색
                    if(questionElement) {
                        questionElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        // 미응답 문항에 시각적 강조 효과 추가 (선택적)
                        questionElement.style.border = '2px solid red';
                        questionElement.style.borderRadius = '0.5rem';
                        setTimeout(() => {
                            questionElement.style.border = '';
                            questionElement.style.borderRadius = '';
                        }, 2000);
                    }
                    break;
                }

                const score = parseInt(checkedInput.value);
                const areaId = checkedInput.getAttribute('data-area');
                const questionContent = checkedInput.getAttribute('data-q-content');
                
                // 응답 내용을 userResponses 배열에 저장
                userResponses.push({
                    index: i,
                    area: areaId,
                    content: questionContent,
                    score: score
                });

                scores[areaId].push(score);
            }

            if (!allAnswered) {
                // 미응답 문항 알림 팝업
                alert('미응답 문항이 있습니다. 응답되지 않은 문항으로 이동합니다.'); 
                return;
            }
            
            // --- 자동 다운로드 실행 ---
            exportResponsesToCSV(); 
            // --------------------------

            let results = {};

            // 영역별 평균 점수 계산 및 진단
            for (const areaId in scores) {
                const sum = scores[areaId].reduce((acc, val) => acc + val, 0);
                const count = scores[areaId].length;
                const average = count > 0 ? (sum / count) : 0;
                
                const roundedAverage = Math.round(average * 10) / 10;
                
                let feedbackKey;
                if (roundedAverage >= 4.0) {
                    feedbackKey = 'high';
                } else if (roundedAverage >= 3.0) {
                    feedbackKey = 'mid';
                } else {
                    feedbackKey = 'low';
                }

                results[areaId] = {
                    average: roundedAverage.toFixed(1),
                    levelInfo: getLevelInfo(roundedAverage), // 레벨 정보 추가
                    feedback: feedbackData[areaId][feedbackKey]
                };
            }

            currentResults = results; // 결과를 전역 변수에 저장

            // 결과 표시
            displayResults(results);
        }

        // 3. 결과 표시 함수
        function displayResults(results) {
            scoreSummary.innerHTML = '';
            feedbackDetails.innerHTML = '';

            const areaTitles = {
                'I': '개인 AI 역량',
                'II': '팀 업무 인식',
                'III': '리더십 방향성'
            };
            
            // A. 점수 요약 카드 생성 (남색/회색 톤)
            for (const areaId in results) {
                const result = results[areaId];
                const card = document.createElement('div');
                
                // 레벨 색상 설정 (Level 3: Green, Level 2: Yellow, Level 1: Red)
                let levelColor = 'text-gray-500'; // 기본값
                let levelBg = 'bg-gray-100';
                
                if (result.levelInfo.level === 3) {
                    levelColor = 'text-emerald-600'; // Level 3: 변화 주도 (녹색 계열)
                    levelBg = 'bg-emerald-50';
                } else if (result.levelInfo.level === 2) {
                    levelColor = 'text-amber-600'; // Level 2: 활용 확장 (노랑/주황 계열)
                    levelBg = 'bg-amber-50';
                } else {
                    levelColor = 'text-rose-600'; // Level 1: 기반 정립 (빨강 계열)
                    levelBg = 'bg-rose-50';
                }

                // 남색/회색 톤 적용
                card.className = 'bg-white border-4 border-slate-400 rounded-xl shadow-lg p-5 sm:p-6 text-center transition hover:shadow-xl';
                card.innerHTML = `
                    <p class="text-base sm:text-lg font-semibold text-slate-700 mb-2">${areaTitles[areaId]}</p>
                    
                    <div class="mb-4 inline-block px-3 py-1 rounded-full ${levelBg} ${levelColor} font-bold text-sm">
                        ${result.levelInfo.name}
                    </div>

                    <div class="text-4xl sm:text-5xl font-extrabold text-slate-600">${result.average}</div>
                    <p class="mt-2 text-lg sm:text-xl font-bold text-gray-800">${result.feedback.title}</p>
                `;
                scoreSummary.appendChild(card);
            }

            // B. 상세 해설 섹션 생성 (옅은 회색 톤)
            for (const areaId in results) {
                const result = results[areaId];
                const detailDiv = document.createElement('div');
                
                // 옅은 회색 톤 적용
                const bgColor = 'bg-gray-100'; // 옅은 회색
                const borderColor = 'border-slate-400'; // 남색 계열 테두리
                const titleColor = 'text-slate-700'; // 남색 계열 제목

                // 반응형 패딩 조정
                detailDiv.className = `p-5 sm:p-6 rounded-xl border-l-4 ${borderColor} ${bgColor} shadow-md`;
                detailDiv.innerHTML = `
                    <h3 class="text-xl sm:text-2xl font-extrabold ${titleColor} mb-3">
                        ${areaTitles[areaId]} (평균: ${result.average}점, ${result.levelInfo.name})
                    </h3>
                    <h4 class="text-lg sm:text-xl font-bold text-gray-900 mb-3">${result.feedback.title}</h4>
                    <p class="text-sm sm:text-base text-gray-700 leading-relaxed whitespace-pre-wrap">${result.feedback.message}</p>
                `;
                feedbackDetails.appendChild(detailDiv);
            }

            // 폼 숨기고 결과 표시
            assessmentForm.classList.add('hidden');
            resultsContainer.classList.remove('hidden');

            // 결과 섹션으로 스크롤 이동
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // 4. 설문 다시 시작 함수 (재시작 버튼 클릭 이벤트)
        function restartAssessment() {
            // 폼 필드 초기화 (응답 내용 삭제)
            assessmentForm.reset();
            
            // 결과 숨기고 폼 표시
            resultsContainer.classList.add('hidden');
            assessmentForm.classList.remove('hidden');
            // 페이지 상단으로 스크롤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // 5. 응답 확인 및 수정 함수 (돌아가기 버튼 클릭 이벤트)
        function goBackToSurvey() {
            // 폼 필드 초기화하지 않음 (응답 내용 유지)
            
            // 결과 숨기고 폼 표시
            resultsContainer.classList.add('hidden');
            assessmentForm.classList.remove('hidden');
            // 페이지 상단으로 스크롤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 초기화 및 이벤트 리스너 설정
        window.onload = () => {
            renderQuestions();
            assessmentForm.addEventListener('submit', calculateAndDisplayResults);
            restartButton.addEventListener('click', restartAssessment); 
            goBackButton.addEventListener('click', goBackToSurvey);
        };
    </script>
</body>
</html>
